<div class="d-flex flex-column h-100">
    <ng-container *ngIf="organization">
        <div class="app-main-navigation-hint app-border-bottom w-100 p-4 sticky-top">
            <b>{{organization?.name!}}</b>
        </div>
        <div>
            <!-- (click)="banner.click()" -->
            <a class="app-profile-header w-100" >
                <div class="app-profile-header-container" [ngClass]="{ 'has-chat' : routeId === 2}">
                    <input #banner class="d-none" type="file" accept="image/" (change)="addBannerFile($event)">
                    <div class="app-profile-header-banner" [ngClass]="{ 'has-chat' : routeId === 2}"
                    [style.background-image]="organization.banner !== undefined ? 'url('+organization.banner+')' : 'url(https://firebasestorage.googleapis.com/v0/b/scout-6b8bf.appspot.com/o/users%2Fbanner.png?alt=media&token=23218500-7914-4932-92ce-55fbcf2716eb)'"
                    ></div>
                </div>
            </a>
            <div class="app-profile-content">
                <div class="app-profile-field d-flex justify-content-end align-items-center">
                    <a class="app-profile-avatar-container mx-auto" [ngClass]="{ 'has-chat' : routeId === 2}">
                        <input #icon class="d-none" type="file" accept="image/" (change)="addIconFile($event)">
                        <img class="app-profile-avatar"
                        [ngClass]="{ 'has-chat' : routeId === 2}"
                        [src]="organization.icon ? organization.icon : '../../../assets/placeholders/default.png'" alt="">
                    </a>
                    <button (click)="openInviteDialog(organization)" *ngIf="member?.user! && member?.position !== 'member'" class="position-absolute" color="primary" mat-stroked-button>
                        <mat-icon>group_add</mat-icon> Invite members
                    </button>
                    <button [matMenuTriggerFor]="apply" *ngIf="!member?.user!" class="position-absolute px-5" color="primary" mat-stroked-button>
                        <mat-icon>note_alt</mat-icon> Apply
                    </button>
                    <mat-menu class="post-menu" #apply="matMenu" xPosition="before">
                        <button (click)="joinOrg(organization)" *ngIf="organization.settings!['direct-join']" mat-menu-item>
                            <mat-icon>meeting_room</mat-icon> Join
                        </button>
                        <button *ngIf="!organization.settings!['direct-join']" mat-menu-item>
                            <mat-icon>border_color</mat-icon> Apply
                        </button>
                        <button disabled="true" *ngIf="organization.settings!['lf-team']" mat-menu-item>
                            <mat-icon>group_add</mat-icon> Apply Team
                        </button>
                      </mat-menu>
                </div>
            </div>
        </div>
        <ng-container *ngIf="routeId !== 2">
            <div class="d-flex text-center px-3 py-2 justify-content-between">
                <span class="h3 font-weight-bold">{{organization.name}}</span>
                <div class="d-flex">
                    <div *ngFor="let link of organization.snsLink">
                        <ng-container *ngIf="link.url.length > 0">
                            <a class="btn-white btn-small mx-1"
                            #tooltip="matTooltip"
                            matTooltipClass="btn-danger pink darken-1"
                            matTooltip="Copy link to clipboard"
                            matTooltipPosition="below"
                            (click)="tooltip.disabled = false; tooltip.toggle()"
                            matTooltipDisabled="true"
                            (mouseleave)="tooltip.disabled = true"
                            [cdkCopyToClipboard]="link.url"
                            matTooltipHideDelay="2000"
                            mat-icon-button> 
                                <i [attr.class]="link.class" [style.color]="link.color"></i>
                            </a>
                        </ng-container>
                    </div>
                    <ng-container *ngIf="member">
                        <a [matMenuTriggerFor]="settings" class="ml-2" color="primary" mat-icon-button>
                            <mat-icon>more_horiz</mat-icon>
                        </a>
                        <mat-menu class="post-menu" #settings="matMenu" xPosition="before">
                            <button *ngIf="organization.owner === member.user || member?.position! === 'admin'" [routerLink]="'./settings'" class="text-muted" mat-menu-item>
                                <mat-icon class="material-icons-round" [inline]="true" matPrefix>settings</mat-icon> Settings
                            </button>
                            <button *ngIf="organization.owner !== member.user" (click)="leaveOrg(organization)" class="text-muted" mat-menu-item>
                                <mat-icon class="material-icons-round" [inline]="true" matPrefix>exit_to_app</mat-icon> Leave
                            </button>
                        </mat-menu>
                    </ng-container>
                </div>
            </div>
            <div *ngIf="organization.description" class="mb-3 w-100 px-3 font-weight-light h6">
                {{organization.description}}
            </div>
        </ng-container>
        
    </ng-container>
    
    <ng-template #noorg>
        <div class="app-main-navigation-hint app-border-bottom w-100 p-4 sticky-top">
            <b>Organization not found</b>
        </div>
        <div class="app-profile-header-container mb-5">
            <a class="app-profile-header w-100" >
                <div class="app-profile-header-container">
                    <input #banner class="d-none" type="file" accept="image/">
                    <div class="app-profile-header-banner" 
                    [style.background-image]="'url(https://firebasestorage.googleapis.com/v0/b/scout-6b8bf.appspot.com/o/users%2Fbanner.png?alt=media&token=23218500-7914-4932-92ce-55fbcf2716eb)'"
                    ></div>
                </div>
            </a>
            <div class="app-profile-content p-3">
                <div class="app-profile-field d-flex justify-content-center">
                    <a class="app-profile-avatar-container w-25" >
                        <input #icon class="d-none" type="file" accept="image/">
                        <img class="app-profile-avatar w-100 h-100" [src]="'../../../assets/placeholders/default.png'" alt="">
                    </a>
                </div>
            </div>
        </div>
    </ng-template>
    <!-- [(selectedIndex)]="selectedIndex" -->
    <mat-tab-group animationDuration="0ms" [(selectedIndex)]="routeId" class="org-content col px-0">
        <mat-tab>
            <ng-template mat-tab-label>
                <div class="position-absolute h-100 w-100 d-flex justify-content-center align-items-center" routerLink="./">Home</div>
            </ng-template>
            <ng-container *ngIf="routeId === -1 || routeId === 0">
                <div *ngIf="global.user && member?.user!" class="app-main-post row justify-content-center pb-2 pt-4 m-0 app-border-bottom">
                    <div class="app-main-post-profile col-1 m-0 p-0">
                        <img class="rounded-circle" [src]="global.user.avatar ? global.user?.avatar : global.user?.defaultAvatar" width="50">
                    </div>
                    <div class="col-10">
                        <form #postForm="ngForm" autocomplete="off" autocapitalize="off">
                            <mat-form-field class="w-100 post-specific py-1" appearance="fill">
                                <mat-label>What's on your mind...</mat-label>
                                <textarea [(ngModel)]="description" [ngModelOptions]="{standalone: true}" matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="25"></textarea>
                            </mat-form-field>
                            <div class="row app-post-file-submit-options">
                                <div *ngIf="filePrev" class="w-100 my-1">
                                    <img class="app-post-file-preview" [src]="filePrev">
                                    <button (click)="file.value=''; filePrev='';" class="app-post-file-preview-remove btn-fab-display" mat-mini-fab color="primary" aria-label="Example icon button with a menu icon">
                                        <mat-icon width="15">close</mat-icon>
                                    </button>
                                </div>
                                <div class="col-9 app-post-file-opt">
                                    <input #file class="d-none" type="file" (change)="upload($event)" accept="*.png.jpg">
                                    <button (click)="file.click()" [disabled]="isPosting" class="btn-fab-display" mat-mini-fab color="primary" aria-label="Example icon button with a menu icon">
                                        <mat-icon width="15">image</mat-icon>
                                    </button>
                                </div>
                                <div class="col-3">
                                    <button (click)="postContent(); isPosting = true" [disabled]="(!description && !file.value) || isPosting" class="w-100 my-1 rounded-pill" color="primary" type="button" mat-raised-button>Post</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <ng-container *ngIf="(orgPost$ | async) as posts">
                    <div *ngIf="posts.length > 0" class="app-main-post-content w-100">
                        <div *ngFor="let post of posts; trackBy: postIdentity" class='app-user-post row justify-content-center pt-3 pb-1 m-0 app-border-bottom' (click)="navigatePost(post?.contentFrom!+'/'+post.userRef$?.username+'/posts/'+post.pid)">
                            <div class="app-main-post-profile h-100 col-1 m-0 p-0">
                                <img class="rounded-circle" [src]="post.userRef$?.avatar ? post.userRef$?.avatar : post.userRef$?.defaultAvatar" width="50">
                            </div>
                            <div class="app-main-post-container col-10 h-100 pb-1 pr-0">
                                <div class="app-main-post-data d-flex flex-row align-items-center w-100">
                                    <span class="mr-1 text-truncate"><b>{{post.userRef$?.displayName ? post.userRef$?.displayName : post.userRef$?.username}}</b></span>
                                    <!-- <span class="text-muted text-truncate">@{{post.userRef$?.username}}</span> -->
                                    <span class="mx-1 text-muted">—</span>
                                    <span class="text-muted">{{global.refDate(post?.date!) | timeAgo}}</span>
                                    <div *ngIf="post.userRef$?.uid === global.user?.uid" class="ml-auto">
                                        <mat-icon [matMenuTriggerFor]="postMenu" role="button" class="align-self-center text-muted" (click)="$event.stopPropagation()">more_horiz</mat-icon>
                                        <mat-menu class="post-menu" #postMenu="matMenu" xPosition="before">
                                            <button (click)="global.openPostDeleteDialog(post)" class="text-muted" mat-menu-item>
                                                <mat-icon class="material-icons-rounded" [inline]="true" matPrefix>delete</mat-icon> Delete
                                            </button>
                                        </mat-menu>
                                    </div>
                                </div>
                                <div *ngIf="post?.description" class="app-main-post-description pt-1 pb-1">{{post?.description}}</div>
                                <div *ngIf="post?.attachment" class="app-main-post-attachment mt-1">
                                    <img draggable="true" [src]="post?.attachment">
                                </div>
                                <div class="app-main-post-interaction row justify-content-between align-item-center w-100 m-0 px-3" (click)="$event.stopPropagation()">
                                    <button (click)="likeUnlikePost(post?.pid!)" class="mx-2" mat-icon-button>
                                        <mat-icon [ngClass]="post.likeRef$ ? 'material-icons-rounded' : 'material-icons-outlined'" [inline]="true" color="primary" matPrefix>thumb_up</mat-icon><span>{{post?.likesCount! > 0 ? global.abbrNum(post?.likesCount, 2) : ''}}</span>
                                    </button>
                                    <button [autofocus]="false" (click)="global.openCommentDialog(post, global?.user!)" class="mx-2" mat-icon-button>
                                        <mat-icon class="material-icons-outlined" [inline]="true" color="primary">mode_comment</mat-icon><span>{{post?.commentsCount! > 0 ? global.abbrNum(post?.commentsCount, 2) : ''}}</span>
                                    </button>
                                    <button class="mx-2" mat-icon-button>
                                        <mat-icon [inline]="true" color="primary">share</mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="w-100 app-border-bottom"></div>
                    <div *ngIf="posts.length > 5" class="w-100 text-center my-5">
                        <h1 class="text-muted lead">You're all Caught Up</h1>
                        <p class="text-muted">You've seen all new post from the past 48 hours.</p>
                    </div>
                </ng-container>
            </ng-container>
        </mat-tab>
        <mat-tab>
            <ng-template mat-tab-label>
                <div class="position-absolute h-100 w-100 d-flex justify-content-center align-items-center" routerLink="./events">Events</div>
            </ng-template>
            <ng-container *ngIf="routeId === 1">
                <div *ngIf="global.user && member?.user!" class="app-main-post row justify-content-center py-4 m-0 app-border-bottom">
                    <div class="app-main-post-profile col-1 m-0 p-0">
                        <img class="rounded-circle" [src]="organization.icon ? organization.icon : '../../../assets/placeholders/default.png'" width="50">
                    </div>
                    <div class="col-10">
                        <div *ngIf="!isCreateEventActive" (click)="isCreateEventActive = !isCreateEventActive" class="show-create-event d-flex align-items-center h-100 w-100 px-2 h5 font-weight-light">Create Event...</div>
                        <div *ngIf="isCreateEventActive">
                            <form [formGroup]="event" autocomplete="off" autocapitalize="off">
                                <mat-form-field class="w-75" appearance="outline">
                                    <mat-label>Event Topic</mat-label>
                                    <input #eventTopic class="font-weight-light" formControlName="topic" matInput placeholder="What's your event?" required>
                                </mat-form-field>
                                <mat-form-field class="w-50" appearance="outline">
                                    <mat-label>Start date</mat-label>
                                    <input #eventStart matInput [matDatepicker]="picker" formControlName="start" placeholder="Start date" required>
                                    <mat-hint>MM/DD/YYYY</mat-hint>
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-datepicker #picker></mat-datepicker>
                                    <mat-error *ngIf="event.controls['start'].hasError('matStartDateInvalid')">Invalid start date</mat-error>
                                </mat-form-field>
                                <mat-form-field class="w-100 post-specific py-1" appearance="outline">
                                    <mat-label>Description</mat-label>
                                    <textarea class="font-weight-light" placeholder="Tell people a little more about your event." formControlName="description" matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="5" cdkAutosizeMaxRows="14"></textarea>
                                </mat-form-field>
                                <div class="d-flex flex-column mb-2">    
                                    <mat-hint>Cover Image</mat-hint>
                                    <div *ngIf="coverPrev" class="w-100 my-1">
                                        <img class="app-post-file-preview" [src]="coverPrev">
                                        <button (click)="cover.value=''; coverPrev='';" class="app-post-file-preview-remove btn-fab-display" mat-mini-fab color="primary" aria-label="Example icon button with a menu icon">
                                            <mat-icon width="15">close</mat-icon>
                                        </button>
                                    </div>
                                    <input #cover class="d-none" type="file" (change)="uploadCover($event)" accept="*.png.jpg">
                                    <button (click)="cover.click()" [disabled]="isPosting" class="w-50" mat-stroked-button>Upload Cover Image</button>
                                </div>
                                <button (click)="isCreateEventActive = !isCreateEventActive; cover.value=''; coverPrev=''; event.reset()" class="w-50 my-1" type="button" mat-stroked-button>Cancel</button>
                                <button #createEventBtn (click)="createEvent()" [disabled]="!eventTopic.value || !eventStart.value" class="w-50 my-1" color="primary" type="button" mat-raised-button>Create</button>
                            </form>
                        </div>
                    </div>
                </div>
                <ng-container *ngIf="(events$ | async) as events">
                    <div *ngIf="events.length > 0; else noevents" class="app-main-post-content w-100">
                        <div *ngFor="let event of events; trackBy: postIdentity" class='app-user-post row justify-content-center py-3 m-0 app-border-bottom'>
                            <div class="app-main-post-profile h-100 col-1 m-0 p-0">
                                <img class="rounded-circle" [src]="organization.icon ? organization.icon : '../../../assets/placeholders/default.png'" width="50">
                            </div>
                            <div class="app-main-post-container col-10 h-100 pb-1 pr-0">
                                <div class="app-main-post-data d-flex flex-row align-items-center w-100">
                                    <span class="mr-1 text-truncate"><b>{{organization.name}}</b></span>
                                    <!-- <mat-chip-list>
                                        <mat-chip class="app-post-game" [style.background-color]="post.gameRef$?.bgColor">
                                            <img matChipAvatar [src]="post.gameRef$?.icon">{{post.gameRef$?.name}}
                                        </mat-chip>
                                    </mat-chip-list> -->
                                    <!-- <span class="text-muted text-truncate">@{{post.userRef$?.username}}</span> -->
                                    <span class="mx-1 text-muted">—</span>
                                    <span class="text-muted">{{global.refDate(event.date!) | timeAgo}}</span>
                                    <div *ngIf="event.host === global.user?.uid" class="ml-auto">
                                        <mat-icon [matMenuTriggerFor]="postMenu" role="button" class="align-self-center text-muted" (click)="$event.stopPropagation()">more_horiz</mat-icon>
                                        <mat-menu class="post-menu" #postMenu="matMenu" xPosition="before">
                                            <button (click)="global.openEventCancelDialog(event)" class="text-muted" mat-menu-item>
                                                <mat-icon class="material-icons-round" [inline]="true" matPrefix>event_busy</mat-icon> Cancel
                                            </button>
                                        </mat-menu>
                                    </div>
                                </div>
                                <div class="app-main-post-description pt-1 h4 font-weight-light"><u>{{event?.topic}}</u></div>
                                <div class="app-main-post-description font-weight-light pb-1"><mark class="rounded">Start date: <u>{{toDate(event.startDate!)}}</u></mark></div>
                                <div *ngIf="event?.description" class="app-main-post-description pt-1 pb-1">{{event?.description}}</div>
                                <div *ngIf="event?.cover" class="app-main-post-attachment mt-1">
                                    <img draggable="true" [src]="event?.cover">
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-template #noevents>
                    <div class="w-100 text-center my-5">
                        <div class="display-5 text-muted font-weight-light">There are no upcomming events.</div>
                    </div>
                </ng-template>
            </ng-container>
        </mat-tab>
        <mat-tab [disabled]="!member?.user!">
            <ng-template mat-tab-label>
                <div class="position-absolute h-100 w-100 d-flex justify-content-center align-items-center" routerLink="./chat">Chat</div>
            </ng-template>
            <ng-container *ngIf="routeId === 2">
                <div class="d-flex flex-column w-100 h-100 position-relative" style="overflow: hidden;" [style.max-height.px]="setChatHeight()">
                    <!-- [style.height.px]="setChatHeight(chatEl.offsetHeight)" -->
                    <div class="chat-content d-flex flex-column-reverse flex-grow-1 w-100 px-4">
                        <ng-container *ngIf="(chats$ | async) as chats">
                            <ng-container *ngFor="let chat of chats">
                                <div *ngIf="chat.user === global.user?.uid; else notyours" class="chat-message ml-auto my-2 d-flex align-items-start">
                                    <div class="d-flex flex-column align-items-end">
                                        <span class="font-weight-light text-muted mr-1">You</span>
                                        <span *ngIf="chat.content" class="chat-message-content rounded-pill  pink darken-1 px-3 py-2 font-weight-light">{{chat.content}}</span>
                                        <img class="chat-message-attachment my-1" [src]="chat.attachment">
                                        <span class="font-weight-light text-muted">{{toRawDate(chat.date!) | timeAgo}}</span>
                                    </div>
                                    <img class="rounded-circle ml-2" [src]="chat.userRef?.avatar ? chat.userRef?.avatar : chat.userRef?.defaultAvatar" width="50" height="50">
                                </div>
                                <ng-template #notyours>
                                    <div class="chat-message my-2 d-flex align-items-start">
                                        <img class="rounded-circle mr-2" [src]="chat.userRef?.avatar ? chat.userRef?.avatar : chat.userRef?.defaultAvatar" width="50" height="50">
                                        <div class="d-flex flex-column align-items-start">
                                            <span class="font-weight-light text-muted ml-1">{{chat.userRef?.displayName ? chat.userRef?.displayName : chat.userRef?.username}}</span>
                                            <span *ngIf="chat.content" class="chat-message-content rounded-pill bg-dark px-3 py-2 font-weight-light">{{chat.content}}</span>
                                            <img *ngIf="chat.attachment" class="chat-message-attachment my-1" [src]="chat.attachment">
                                            <span class="font-weight-light text-muted">{{toRawDate(chat.date!) | timeAgo}}</span>
                                        </div>
                                    </div>
                                </ng-template>
                            </ng-container>
                        </ng-container>
                        
                    </div>
                    <div class="chat-input-preview app-border-top w-100 py-2 px-3">
                        <form [formGroup]="chat">
                            <div *ngIf="chatAttachmentPrev" class="attachment-container">
                                <div class="attachment-preview" [style.background-image]="'url('+chatAttachmentPrev+')'"></div>
                                <a (click)="attachment.value=''; chatAttachmentPrev='';" mat-mini-fab>
                                    <mat-icon>close</mat-icon>
                                </a>
                            </div>
                            <div class="d-flex justify-content-center align-items-center">
                                <input #attachment class="d-none" type="file" (change)="uploadChatAttachment($event)" accept="*.png.jpg">
                                <button (click)="attachment.click()" [disabled]="isPosting" color="accent" mat-mini-fab>
                                    <mat-icon class="material-icons-round">link</mat-icon>
                                </button>
                                <div class="d-flex w-100">
                                    <mat-form-field class="w-100 mx-3" style="height: 68px;" appearance="outline">
                                        <textarea (keydown.enter)="$event.preventDefault(); sendChat()" #chatContent formControlName="content" class="font-weight-light" placeholder="Message"autofocus matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="4"></textarea>
                                    </mat-form-field>
                                </div>
                                <button #send (click)="sendChat()" [disabled]="checkForWhiteSpace(chatContent.value) && !attachment.value" color="primary" mat-mini-fab>
                                    <mat-icon class="material-icons-round">send</mat-icon>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </ng-container>
        </mat-tab>
        <mat-tab [disabled]="!member?.user!">
            <ng-template mat-tab-label>
                <div class="position-absolute h-100 w-100 d-flex justify-content-center align-items-center" routerLink="./members">Members</div>
            </ng-template>
            <mat-tab-group mat-align-tabs="center" animationDuration="0ms">
                <mat-tab label="Joined">
                    <div *ngIf="members$ | async as members" class="row w-100 justify-content-center align-items-center py-2">
                        <h3 class="px-4">Admin(s)</h3>
                        <ng-container *ngFor="let account of members">
                            <ng-container *ngIf="account.position === 'admin'">
                                <ng-container *ngIf="member?.position! !== 'member' && member?.position !== 'manager'; else noperms">
                                    <a mat-button [matMenuTriggerFor]="menu" class="member-list-card col-3 py-3 rounded px-2 d-flex flex-column justify-content-center align-items-center ng-star-inserted">
                                        <img width="80" height="80" class="rounded-circle mb-2" [src]="account.userRef?.avatar ? account.userRef?.avatar : account.userRef?.defaultAvatar" alt="">
                                        <p style="max-width: 110px;" class="text-truncate">{{account.userRef?.displayName ? account.userRef?.displayName : account.userRef?.username}}</p>
                                    </a>
                                </ng-container>
                                <ng-template #noperms>
                                    <a mat-button class="member-list-card col-3 py-3 rounded px-2 d-flex flex-column justify-content-center align-items-center ng-star-inserted">
                                        <img width="80" height="80" class="rounded-circle mb-2" [src]="account.userRef?.avatar ? account.userRef?.avatar : account.userRef?.defaultAvatar" alt="">
                                        <p style="max-width: 110px;" class="text-truncate">{{account.userRef?.displayName ? account.userRef?.displayName : account.userRef?.username}}</p>
                                    </a>
                                </ng-template>
                                
                                <mat-menu  #menu="matMenu" xPosition="before">
                                    <a mat-menu-item [href]="organization.gameRef+'/'+account.userRef?.username" target="_blank">
                                        <mat-icon>person</mat-icon>
                                        <span>View Profile</span>
                                    </a>
                                    <button mat-menu-item [matMenuTriggerFor]="assignPosition">
                                        <mat-icon>badge</mat-icon>
                                        <span>Position</span>
                                    </button>
                                    <button mat-menu-item [matMenuTriggerFor]="assignRoles">
                                        <mat-icon>token</mat-icon>
                                        <span>Roles</span>
                                    </button>
                                    <button disabled="true" *ngIf="member?.user! !== account.user" mat-menu-item>
                                        <mat-icon>lock</mat-icon>
                                        <span>Ban user</span>
                                    </button>
                                    <button (click)="kickMember(organization, account)" *ngIf="member?.user! !== account.user" mat-menu-item>
                                        <mat-icon>person_remove</mat-icon>
                                        <span>Kick user</span>
                                    </button>
                                </mat-menu>
                                <mat-menu #assignPosition="matMenu">
                                    <mat-radio-group (change)="changePosition(account)" (click)="$event.stopPropagation()" class="d-flex flex-column px-2 align" [(ngModel)]="account.position">
                                        <mat-radio-button class="mx-1 my-2"  *ngFor="let position of positions" [value]="position.id">
                                            <span class="text-white text-capitalize">{{position.id}}</span>
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </mat-menu>
                                <mat-menu #assignRoles="matMenu">
                                    <div class="d-flex justify-content-between align-items-center" mat-menu-item *ngFor="let role of roles" (click)="$event.stopPropagation()">
                                        {{role.name}} 
                                    <mat-slide-toggle (change)="saveRole(account, role)" [checked]="checkHasRole(account, role)" class="ml-2"></mat-slide-toggle></div>
                                </mat-menu>
                            </ng-container>
                        </ng-container>
                        <h3 class="px-4">Manager(s)</h3>
                        <ng-container *ngFor="let account of members">
                            <ng-container *ngIf="account.position === 'manager'">
                                <ng-container *ngIf="member?.position! !== 'member'; else noperms">
                                    <a mat-button [matMenuTriggerFor]="menu" class="member-list-card col-3 py-3 rounded px-2 d-flex flex-column justify-content-center align-items-center ng-star-inserted">
                                        <img width="80" height="80" class="rounded-circle mb-2" [src]="account.userRef?.avatar ? account.userRef?.avatar : account.userRef?.defaultAvatar" alt="">
                                        <p style="max-width: 110px;" class="text-truncate">{{account.userRef?.displayName ? account.userRef?.displayName : account.userRef?.username}}</p>
                                    </a>
                                </ng-container>
                                <ng-template #noperms>
                                    <a mat-button class="member-list-card col-3 py-3 rounded px-2 d-flex flex-column justify-content-center align-items-center ng-star-inserted">
                                        <img width="80" height="80" class="rounded-circle mb-2" [src]="account.userRef?.avatar ? account.userRef?.avatar : account.userRef?.defaultAvatar" alt="">
                                        <p style="max-width: 110px;" class="text-truncate">{{account.userRef?.displayName ? account.userRef?.displayName : account.userRef?.username}}</p>
                                    </a>
                                </ng-template>
                                
                                <mat-menu  #menu="matMenu" xPosition="before">
                                    <a mat-menu-item [href]="organization.gameRef+'/'+account.userRef?.username" target="_blank">
                                        <mat-icon>person</mat-icon>
                                        <span>View Profile</span>
                                    </a>
                                    <button *ngIf="organization.owner === account.user" mat-menu-item [matMenuTriggerFor]="assignPosition">
                                        <mat-icon>badge</mat-icon>
                                        <span>Position</span>
                                    </button>
                                    <button mat-menu-item [matMenuTriggerFor]="assignRoles">
                                        <mat-icon>token</mat-icon>
                                        <span>Roles</span>
                                    </button>
                                    <button disabled="true" *ngIf="member?.user! !== account.user" mat-menu-item>
                                        <mat-icon>lock</mat-icon>
                                        <span>Ban user</span>
                                    </button>
                                    <button (click)="kickMember(organization, account)" *ngIf="member?.user! !== account.user" mat-menu-item>
                                        <mat-icon>person_remove</mat-icon>
                                        <span>Kick user</span>
                                    </button>
                                </mat-menu>
                                <mat-menu #assignPosition="matMenu">
                                    <mat-radio-group (change)="changePosition(account)" (click)="$event.stopPropagation()" class="d-flex flex-column px-2 align" [(ngModel)]="account.position">
                                        <mat-radio-button class="mx-1 my-2"  *ngFor="let position of positions" [value]="position.id">
                                            <span class="text-white text-capitalize">{{position.id}}</span>
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </mat-menu>
                                <mat-menu #assignRoles="matMenu">
                                    <div class="d-flex justify-content-between align-items-center" mat-menu-item *ngFor="let role of roles" (click)="$event.stopPropagation()">
                                        {{role.name}} 
                                    <mat-slide-toggle (change)="saveRole(account, role)" [checked]="checkHasRole(account, role)" class="ml-2"></mat-slide-toggle></div>
                                </mat-menu>
                            </ng-container>
                        </ng-container>
                        <h3 class="px-4">Member(s)</h3>
                        <ng-container *ngFor="let account of members">
                            <ng-container *ngIf="account.position === 'member'">
                                <ng-container *ngIf="member?.position! !== 'member'; else noperms">
                                    <a mat-button [matMenuTriggerFor]="menu" class="member-list-card col-3 py-3 rounded px-2 d-flex flex-column justify-content-center align-items-center ng-star-inserted">
                                        <img width="80" height="80" class="rounded-circle mb-2" [src]="account.userRef?.avatar ? account.userRef?.avatar : account.userRef?.defaultAvatar" alt="">
                                        <p style="max-width: 110px;" class="text-truncate">{{account.userRef?.displayName ? account.userRef?.displayName : account.userRef?.username}}</p>
                                    </a>
                                </ng-container>
                                <ng-template #noperms>
                                    <a mat-button class="member-list-card col-3 py-3 rounded px-2 d-flex flex-column justify-content-center align-items-center ng-star-inserted">
                                        <img width="80" height="80" class="rounded-circle mb-2" [src]="account.userRef?.avatar ? account.userRef?.avatar : account.userRef?.defaultAvatar" alt="">
                                        <p style="max-width: 110px;" class="text-truncate">{{account.userRef?.displayName ? account.userRef?.displayName : account.userRef?.username}}</p>
                                    </a>
                                </ng-template>
                                
                                <mat-menu  #menu="matMenu" xPosition="before">
                                    <a mat-menu-item [href]="organization.gameRef+'/'+account.userRef?.username" target="_blank">
                                        <mat-icon>person</mat-icon>
                                        <span>View Profile</span>
                                    </a>
                                    <button mat-menu-item [matMenuTriggerFor]="assignPosition">
                                        <mat-icon>badge</mat-icon>
                                        <span>Position</span>
                                    </button>
                                    <button mat-menu-item [matMenuTriggerFor]="assignRoles">
                                        <mat-icon>token</mat-icon>
                                        <span>Roles</span>
                                    </button>
                                    <button disabled="true" *ngIf="member?.user! !== account.user" mat-menu-item>
                                        <mat-icon>lock</mat-icon>
                                        <span>Ban user</span>
                                    </button>
                                    <button (click)="kickMember(organization, account)" *ngIf="member?.user! !== account.user" mat-menu-item>
                                        <mat-icon>person_remove</mat-icon>
                                        <span>Kick user</span>
                                    </button>
                                </mat-menu>
                                <mat-menu #assignPosition="matMenu">
                                    <mat-radio-group (change)="changePosition(account)" (click)="$event.stopPropagation()" class="d-flex flex-column px-2 align" [(ngModel)]="account.position">
                                        <mat-radio-button class="mx-1 my-2"  *ngFor="let position of positions" [value]="position.id">
                                            <span class="text-white text-capitalize">{{position.id}}</span>
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </mat-menu>
                                <mat-menu #assignRoles="matMenu">
                                    <div class="d-flex justify-content-between align-items-center" mat-menu-item *ngFor="let role of roles" (click)="$event.stopPropagation()">
                                        {{role.name}} 
                                    <mat-slide-toggle (change)="saveRole(account, role)" [checked]="checkHasRole(account, role)" class="ml-2"></mat-slide-toggle></div>
                                </mat-menu>
                            </ng-container>
                        </ng-container>
                    </div>
                </mat-tab>
                <mat-tab label="Pending" *ngIf="member?.user! && member.position !== 'member'">
                    <ng-container *ngIf="applications$ | async as applications">
                        <div *ngIf="applications.length > 0; else noapplications">
                            <div *ngFor="let application of applications" class="d-flex app-border-top app-border-bottom py-3">
                                <div class="col-2 d-flex justify-content-center">
                                    <img class="rounded-circle" [src]="application.userRef?.avatar ? application.userRef?.avatar : application.userRef?.defaultAvatar" width="50" height="50">
                                </div>
                                <div class="col px-2 d-flex align-items-center">
                                    <div>
                                        <div class="font-weight-bold h5">{{application.userRef?.username}}</div>
                                        <span class="text-muted text-truncate">Submitted - {{toRawDate(application.date) | timeAgo}}</span>
                                    </div>
                                    <a (click)="openViewDialog(application)" class="ml-auto" mat-raised-button>
                                        <mat-icon class="material-icon-round mr-1" matPrefix>visibility</mat-icon>
                                        View
                                    </a>
                                </div>
                            </div>
                        </div>
                        <ng-template #noapplications>
                            <h1 class=" my-3 text-center">No application received at the moment.</h1>
                        </ng-template>
                    </ng-container>
                </mat-tab>
            </mat-tab-group>
        </mat-tab>
        <!-- <mat-tab>
            <ng-template mat-tab-label>
                <div class="position-absolute h-100 w-100 d-flex justify-content-center align-items-center" routerLink="./jobs">Job</div>
            </ng-template>
            <h1>Job</h1>
        </mat-tab> -->
    </mat-tab-group>
</div>